# שלב א – עיצוב בסיס נתונים ואכלוס נתונים

## שער

**שמות מגישים:** אביתר סאסי, ישראל שעשוע
**המערכת:** מערכת ניהול עובדים
**היחידה הנבחרת:** אגף משאבי אנוש

---

## תוכן עניינים

1. [מבוא](#מבוא)
2. [תרשימי ERD ו‏‐ DSD](#תרשימי-erd-ו‏‐-dsd)
3. [החלטות עיצוב](#החלטות-עיצוב)
4. [שיטות הכנסת נתונים](#שיטות-הכנסת-נתונים)
5. [גיבוי ושחזור](#גיבוי-ושחזור)
6. [שלב ב – שאילתות ואילוצים](#שלב-ב--שאילתות-ואילוצים)
7. [אילוצים וטריגרים](#אילוצים-וטריגרים)

---

## מבוא

המערכת שפותחה עוסקת בניהול עובדים בחברה. היא שומרת מידע על עובדים, מחלקות, תפקידים, חוזים, נוכחות ובקשות חופשה.
המטרה העיקרית של המערכת היא לאפשר שמירה, חיפוש וניתוח של נתונים תפעוליים הקשורים לניהול כח אדם, כולל מעקב אחרי זמני כניסה/יציאה, ניהול חופשות ומבנה ארגוני.

---

## תרשימי ERD ו‏‐ DSD

### תרשים ERD:

![ERD](images/erd.png)

### תרשים DSD (סכמה יחסית מתוך pgAdmin):

![DSD](images/dsd.png)

---

## החלטות עיצוב

* בחרנו ב‏‐6 ישויות עיקריות: `Employee`, `Position`, `EntityDepartment`, `Contract`, `Attendance_Log`, `Leave_Requests`.
* כל ישות כוללת לפחות 3 שדות, ומתוכם לפחות שניים מסוג `DATE`.
* עיצבנו את הסכמה כך שכל הקשרים בין הישויות יהיו חד‏‐ערכיים ומבוססי `Primary Key` ו‏‐`Foreign Key`.
* הסכמה מנורמלת ל‏‐3NF:

  * חוזים מופרדים מטבלת עובדים.
  * תפקידים ומחלקות מוגדרים כטבלאות נפרדות עם זיהוי ברור.
* נעשה שימוש ב‏‐`varchar`, `int`, `date`, `numeric` ו‏‐`time`.

---

## שיטות הכנסת נתונים

בחרנו בשלוש שיטות שונות:

### 1. הכנסת נתונים ידנית דרך pgAdmin

### 2. ייבוא מקובץ CSV

### 3. שימוש בסקריפט Python להפקת פקודות INSERT

---

## גיבוי ושחזור

### ביצוע גיבוי

בוצע גיבוי מלא של בסיס הנתונים:
![Backup](images/backup.png)

### שחזור הנתונים על מחשב אחר

בוצע ניסיון שחזור לקובץ הגיבוי דרך pgAdmin:
![Restore](images/restore.png)

---

## סיום

המערכת נבדקה על‏‐ידי גיבוי, שחזור והרצת שאילתות.
השלב הבא הוא כתיבת שאילתות מתקדמות (שלב 2).

---

# שלב ב – שאילתות ואילוצים

## שאילתות SELECT

### 1. סך השעות הכולל של כל עובד

![Query](uploads/photo_2025-05-12_14-34-09.jpg)
![Result](uploads/photo_2025-05-12_14-34-22.jpg)

### 2. 5 העובדים עם ממוצע השעות היומי הגבוה ביותר (מעל 10 ימי נוכחות)

![Query](uploads/photo_2025-05-12_14-33-43.jpg)
![Result](uploads/photo_2025-05-12_14-33-52.jpg)

### 3. ממוצע שעות לפי מיקום/מחלקה

![Query](uploads/photo_2025-05-12_14-33-13.jpg)
![Result](uploads/photo_2025-05-12_14-33-21.jpg)

### 4. עובדים שמאחרים לעבודה (יותר מ־3 איחורים)

![Query](uploads/photo_2025-05-12_14-32-42.jpg)
![Result](uploads/photo_2025-05-12_14-32-57.jpg)

### 5. מספר עובדים לפי מחלקות

![Query](uploads/photo_2025-05-12_14-32-03.jpg)
![Result](uploads/photo_2025-05-12_14-32-13.jpg)

### 6. ממוצע שעות עבודה לפי תפקיד

![Query](uploads/photo_2025-05-12_14-30-30.jpg)
![Result](uploads/photo_2025-05-12_14-30-41.jpg)

### 7. עובדים שהתחילו חוזה במהלך השנה הנוכחית

![Query](uploads/photo_2025-05-12_14-29-37.jpg)
![Result](uploads/photo_2025-05-12_14-29-53.jpg)

### 8. עובדים עם חוזה ארוך מ־365 ימים

![Query](uploads/photo_2025-05-12_14-31-29.jpg)
![Result](uploads/photo_2025-05-12_14-31-43.jpg)

---

## שאילתות DELETE

### 1. מחיקת תפקידים שאף עובד אינו משויך אליהם

![Delete Unused Positions](uploads/photo_2025-05-12_14-57-38.jpg)

### 2. מחיקת חוזים שהסתיימו לפני שנת 2023

![Delete Old Contracts](uploads/photo_2025-05-12_14-57-08.jpg)

### 3. ניסיון למחיקת עובדים ללא רישומי נוכחות

![Delete Inactive Employees](uploads/photo_2025-05-12_14-58-00.jpg)

---

## שאילתות UPDATE

### 1. הארכת חוזה לעובדים שחוזה העבודה שלהם מסתיים החודש

![Update Contract](uploads/photo_2025-05-12_14-35-37.jpg)

### 2. קידום עובדים עם יותר מ־200 שעות עבודה

![Update Positions](uploads/photo_2025-05-12_14-51-36.jpg)

### 3. שינוי שם מחלקת 'Marketing' ל־'Online Marketing'

![Update Marketing Name](uploads/photo_2025-05-12_14-36-40.jpg)

---

## שימוש ב־COMMIT ו־ROLLBACK

### עדכון זמני


![Not Null](uploads/photo_5_2025-05-13_13-09-44.jpg)

### התחלת טרנזקציה


![Check Salary](uploads/photo_9_2025-05-13_13-09-44.jpg)

### ביצוע COMMIT


![Default Trigger](uploads/photo_1_2025-05-13_13-09-44.jpg)

---

## אילוצים וטריגרים

### הפרת אילוץ `NOT NULL`

![Temporary Update](uploads/photo_6_2025-05-13_13-09-44.jpg)

### הפרת אילוץ `CHECK` – שכר נמוך מדי

![Begin](uploads/photo_7_2025-05-13_13-09-44.jpg)
### ביצוע ROLLBACK


![Commit](uploads/photo_8_2025-05-13_13-09-44.jpg)

### טריגר – ערך ברירת מחדל לשעת כניסה


![Rollback](uploads/photo_4_2025-05-13_13-09-44.jpg)
